SELECT *
FROM `PRODUCT`
JOIN `MAKER` `PRODUCT_MAKER` ON `PRODUCT`.`MAKER_ID` = `PRODUCT_MAKER`.`MAKER_ID`
JOIN `ADDRESS` `PRODUCT_MAKER_ADDRESS` ON `PRODUCT_MAKER`.`ADDRESS_ID` = `PRODUCT_MAKER_ADDRESS`.`ADDRESS_ID`
WHERE `PRODUCT`.`PRODUCT_ID` NOT IN (
    SELECT `PROD`.`PRODUCT_ID`
    FROM `PRODUCT` `PROD`
    JOIN `PRODUCT_BATCH` ON `PROD`.`PRODUCT_ID` = `PRODUCT_BATCH`.`PRODUCT_ID`
    JOIN `PRODUCT_IN_STORAGE` ON `PRODUCT_BATCH`.`BATCH_ID` = `PRODUCT_IN_STORAGE`.`BATCH_ID`
    WHERE `PRODUCT_BATCH`.`EAT_BY_DATE` > DATEADD('DAY',14, CURRENT_DATE)
    GROUP BY `PROD`.`PRODUCT_ID`
    HAVING SUM(`PRODUCT_IN_STORAGE`.`QUANTITY`) > 4 * (
        SELECT SUM(`PRODUCT_ORDER`.`QUANTITY`) / 7
        FROM `PRODUCT`
        JOIN `PRODUCT_BATCH` ON `PRODUCT`.`PRODUCT_ID` = `PRODUCT_BATCH`.`PRODUCT_ID`
        JOIN `PRODUCT_ORDER` ON `PRODUCT_ORDER`.`BATCH_ID` = `PRODUCT_BATCH`.`BATCH_ID`
        JOIN `ORDER` ON `ORDER`.`ORDER_ID` = `PRODUCT_ORDER`.`ORDER_ID`
        WHERE `PRODUCT`.`PRODUCT_ID` = `PROD`.`PRODUCT_ID`
        AND `ORDER`.`ORDER_DATE` BETWEEN DATEADD('DAY',-7, CURRENT_DATE) AND CURRENT_DATE()
    )
);